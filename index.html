<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>إدارة شيك ليست الريمين</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&display=swap');

  body {
    font-family: 'Cairo', sans-serif;
    margin: 0;
    padding: 0;
    background: #f0f2f5;
    color: #333;
  }

  h2 {
    text-align: center;
    padding: 20px 0;
    color: #007BFF;
  }

  .container {
    max-width: 1100px;
    margin: auto;
    padding: 20px;
  }

  form, .report-section {
    background: #fff;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.1);
    margin-bottom: 30px;
  }

  form label {
    display: block;
    margin-bottom: 10px;
    font-weight: 600;
  }

  form input, form select {
    width: 100%;
    padding: 10px 12px;
    margin-top: 4px;
    margin-bottom: 15px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 15px;
    transition: all 0.3s ease;
  }

  form input:focus, form select:focus {
    outline: none;
    border-color: #007BFF;
    box-shadow: 0 0 5px rgba(0,123,255,0.3);
  }

  button {
    background: #007BFF;
    color: #fff;
    border: none;
    padding: 12px 25px;
    font-size: 16px;
    border-radius: 8px;
    cursor: pointer;
    transition: 0.3s;
    margin-top: 5px;
  }

  button:hover {
    background: #0056b3;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    font-size: 14px;
  }

  th, td {
    border: 1px solid #ddd;
    padding: 10px 8px;
    text-align: center;
  }

  th {
    background: #007BFF;
    color: #fff;
  }

  tr:nth-child(even) {
    background: #f9f9f9;
  }

  tr:hover {
    background: #f1f7ff;
  }

  @media (max-width: 768px) {
    form, .report-section {
      padding: 15px;
    }
    th, td {
      font-size: 12px;
      padding: 8px 6px;
    }
    button {
      width: 100%;
      margin-bottom: 10px;
    }
  }

  .report-header {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 15px;
  }

  .report-header input {
    flex: 1;
  }

  .report-header button {
    flex: none;
  }

</style>
</head>
<body>

<h2>إدارة شيك ليست الريمين</h2>

<div class="container">

  <!-- نموذج الإدخال -->
  <form id="remForm">
    <label>اسم الممرضة: <input type="text" id="nurse" required></label>
    <label>الشفت: 
      <select id="shift" required>
        <option value="صباحي">صباحي</option>
        <option value="مسائي">مسائي</option>
      </select>
    </label>
    <label>التاريخ: <input type="date" id="date" required></label>
    <label>اسم المريض: <input type="text" id="patient_name"></label>
    <label>المبلغ: <input type="number" id="amount" step="0.01"></label>
    <label>الشركة: <input type="text" id="company"></label>
    <label>الرقم: <input type="text" id="number"></label>
    <label>سبب الريمين: <input type="text" id="remin_reason"></label>
    <button type="submit">حفظ البيانات</button>
  </form>

  <!-- تقارير -->
  <div class="report-section">
    <h3>عرض التقارير</h3>
    
    <div class="report-header">
      <input type="date" id="reportDate" placeholder="تقرير يومي">
      <button onclick="fetchReport()">عرض التقرير</button>
    </div>

    <div class="report-header">
      <input type="date" id="fromDate" placeholder="من">
      <input type="date" id="toDate" placeholder="إلى">
      <button onclick="fetchReportPeriod()">عرض التقرير للفترة</button>
    </div>

    <div id="report"></div>
  </div>

</div>

<script>
const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycby5VqWrFn4wcV-CBJnvg4GYa_CN2NqjVQu9oniRXSz3xW8SxWa2EFv1-NpJe-MPQMdVoA/exec'; // ضع هنا رابط Google Apps Script

document.getElementById('remForm').addEventListener('submit', async e => {
  e.preventDefault();
  const data = {
    nurse: document.getElementById('nurse').value,
    shift: document.getElementById('shift').value,
    date: document.getElementById('date').value,
    remin_desc: document.getElementById('remin_desc').value,
    patient_name: document.getElementById('patient_name').value,
    amount: document.getElementById('amount').value,
    company: document.getElementById('company').value,
    number: document.getElementById('number').value,
    remin_reason: document.getElementById('remin_reason').value
  };
  const res = await fetch(WEB_APP_URL, {
    method: 'POST',
    body: JSON.stringify(data)
  });
  const result = await res.json();
  alert(result.message);
  document.getElementById('remForm').reset();
});

async function fetchReport() {
  const date = document.getElementById('reportDate').value;
  const res = await fetch(`${WEB_APP_URL}?date=${date}`);
  const data = await res.json();
  renderTable(data);
}

async function fetchReportPeriod() {
  const from = document.getElementById('fromDate').value;
  const to = document.getElementById('toDate').value;
  const res = await fetch(`${WEB_APP_URL}?from=${from}&to=${to}`);
  const data = await res.json();
  renderTable(data);
}

function renderTable(data) {
  if (!data.length) { document.getElementById('report').innerHTML = '<p>لا توجد بيانات.</p>'; return; }

  let total = 0;
  let html = '<table><tr>';
  Object.keys(data[0]).forEach(k => html += `<th>${k}</th>`);
  html += '</tr>';

  data.forEach(row => {
    html += '<tr>';
    Object.values(row).forEach(val => html += `<td>${val}</td>`);
    html += '</tr>';
    if(row['المبلغ']) total += parseFloat(row['المبلغ']);
  });
  html += `<tr><td colspan="${Object.keys(data[0]).length -1}" style="font-weight:bold; background:#e9ecef;">المجموع الكلي</td><td style="font-weight:bold; background:#e9ecef;">${total.toFixed(2)}</td></tr>`;
  html += '</table>';
  document.getElementById('report').innerHTML = html;
}

function printReport() {
  const printContents = document.getElementById('report').innerHTML;
  const w = window.open('', '', 'width=900,height=600');
  w.document.write('<html><head><title>تقرير الريمين</title></head><body>');
  w.document.write(printContents);
  w.document.write('</body></html>');
  w.document.close();
  w.print();
}
</script>

</body>
</html>
